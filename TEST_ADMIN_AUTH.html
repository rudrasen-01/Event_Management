<!DOCTYPE html>
<html>
<head>
    <title>Admin Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        .section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-left: 4px solid #4CAF50; }
        pre { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 4px; overflow-x: auto; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .error { color: #f44336; }
        .success { color: #4CAF50; }
        .warning { color: #ff9800; }
        input { padding: 8px; margin: 5px 0; width: 300px; border: 1px solid #ddd; border-radius: 4px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Admin Authentication Debugger</h1>
        
        <div class="section">
            <h2>üì¶ Current localStorage Status</h2>
            <button onclick="checkLocalStorage()">Check Storage</button>
            <button onclick="clearStorage()">Clear Storage</button>
            <pre id="storageOutput">Click "Check Storage" to see current state</pre>
        </div>

        <div class="section">
            <h2>üîë Test Admin Login</h2>
            <label>Email:</label>
            <input type="email" id="loginEmail" value="admin@eventplatform.com" />
            
            <label>Password:</label>
            <input type="password" id="loginPassword" value="admin123" />
            
            <br><button onclick="testLogin()">Test Login</button>
            <pre id="loginOutput">Not tested yet</pre>
        </div>

        <div class="section">
            <h2>üìä Test Admin API Calls</h2>
            <button onclick="testAdminStats()">Test /api/admin/stats</button>
            <button onclick="testAdminVendors()">Test /api/admin/vendors</button>
            <button onclick="testAdminInquiries()">Test /api/admin/inquiries</button>
            <pre id="apiOutput">Not tested yet</pre>
        </div>

        <div class="section">
            <h2>üí° Instructions</h2>
            <ol>
                <li>First, check your current storage status</li>
                <li>If no token found, test login with admin credentials</li>
                <li>After successful login, test admin API calls</li>
                <li>If APIs work here but not in app, it's a frontend issue</li>
            </ol>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        function checkLocalStorage() {
            const output = document.getElementById('storageOutput');
            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('authUser');
            const vendorToken = localStorage.getItem('vendorToken');
            
            let result = '=== Current Storage ===\n\n';
            
            if (token) {
                result += '‚úÖ authToken found:\n' + token.substring(0, 50) + '...\n\n';
            } else {
                result += '‚ùå authToken: NOT FOUND\n\n';
            }
            
            if (user) {
                result += '‚úÖ authUser found:\n' + JSON.stringify(JSON.parse(user), null, 2) + '\n\n';
            } else {
                result += '‚ùå authUser: NOT FOUND\n\n';
            }
            
            if (vendorToken) {
                result += '‚ö†Ô∏è  vendorToken also found (should use authToken for admin)\n';
            }
            
            output.textContent = result;
        }

        function clearStorage() {
            localStorage.clear();
            document.getElementById('storageOutput').textContent = '‚úÖ All storage cleared. Refresh page or login again.';
        }

        async function testLogin() {
            const output = document.getElementById('loginOutput');
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            output.textContent = '‚è≥ Testing login...';
            
            try {
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    output.textContent = `‚ùå Login Failed (${response.status}):\n\n` + 
                        JSON.stringify(data, null, 2);
                    return;
                }
                
                // Store token like the app does
                localStorage.setItem('authToken', data.data.token);
                localStorage.setItem('authUser', JSON.stringify(data.data.user));
                
                output.textContent = `‚úÖ Login Successful!\n\n` +
                    `User: ${data.data.user.name}\n` +
                    `Email: ${data.data.user.email}\n` +
                    `Role: ${data.data.user.role}\n\n` +
                    `Token stored in localStorage.\n\n` +
                    `Full Response:\n` +
                    JSON.stringify(data, null, 2);
                    
            } catch (error) {
                output.textContent = `‚ùå Network Error:\n${error.message}`;
            }
        }

        async function testAdminStats() {
            await testAPI('/admin/stats', 'apiOutput');
        }

        async function testAdminVendors() {
            await testAPI('/admin/vendors?page=1&limit=10', 'apiOutput');
        }

        async function testAdminInquiries() {
            await testAPI('/admin/inquiries?page=1&limit=10', 'apiOutput');
        }

        async function testAPI(endpoint, outputId) {
            const output = document.getElementById(outputId);
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                output.textContent = '‚ùå No token found. Please login first.';
                return;
            }
            
            output.textContent = `‚è≥ Testing ${endpoint}...`;
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    output.textContent = `‚ùå API Failed (${response.status}):\n\n` + 
                        JSON.stringify(data, null, 2);
                    return;
                }
                
                output.textContent = `‚úÖ API Success!\n\n` +
                    `Endpoint: ${endpoint}\n\n` +
                    `Response:\n` +
                    JSON.stringify(data, null, 2).substring(0, 1000) + '...';
                    
            } catch (error) {
                output.textContent = `‚ùå Network Error:\n${error.message}`;
            }
        }

        // Auto-check storage on load
        window.onload = checkLocalStorage;
    </script>
</body>
</html>
